<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RefOS: apps/selfloader/src/selfloader.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RefOS
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">Multi-server operating system on seL4</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('selfloader_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">selfloader.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Process selfloader system application for RefOS.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="selfloader_8h_source.html">selfloader.h</a>&quot;</code><br />
<code>#include &lt;elf/elf.h&gt;</code><br />
<code>#include &lt;<a class="el" href="refos_8h_source.html">refos/refos.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="share_8h_source.html">refos/share.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="vmlayout_8h_source.html">refos/vmlayout.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="init_8h_source.html">refos-util/init.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="walloc_8h_source.html">refos-util/walloc.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="morecore_8h_source.html">refos-io/morecore.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="stdio_8h_source.html">refos-io/stdio.h</a>&gt;</code><br />
<code>#include &lt;utils/arith.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a6d4ed7b4ceed7d4aef1a7763861716a7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a6d4ed7b4ceed7d4aef1a7763861716a7">SELFLOADER_ELF_HEADER_SIZE</a>&#160;&#160;&#160;<a class="el" href="refos_8h.html#a0928ee9c4bf6581eab888ff5514a8af2">REFOS_PAGE_SIZE</a></td></tr>
<tr class="separator:a6d4ed7b4ceed7d4aef1a7763861716a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a66848c03663c2ae3342291b7d019fe38"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a66848c03663c2ae3342291b7d019fe38">sl_roundup_page</a> (int addr)</td></tr>
<tr class="separator:a66848c03663c2ae3342291b7d019fe38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91b4013891731e48dbbaa9eefa85e681"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a91b4013891731e48dbbaa9eefa85e681">sl_setup_elf_header</a> (<a class="el" href="serv__client__helper_8h.html#ae5a06732da52043c9460215f5d8ecaa8">serv_connection_t</a> *fsSession)</td></tr>
<tr class="memdesc:a91b4013891731e48dbbaa9eefa85e681"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open the ELF header dataspace, and map it so we can read it.  <a href="selfloader_8c.html#a91b4013891731e48dbbaa9eefa85e681">More...</a><br /></td></tr>
<tr class="separator:a91b4013891731e48dbbaa9eefa85e681"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b58dd5a03d35010ec7803a72b909b01"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a8b58dd5a03d35010ec7803a72b909b01">sl_create_zero_segment</a> (seL4_Word start, seL4_Word size, seL4_Word windowSize, <a class="el" href="init_8h.html#a323f16cf7302a986370bfe46c8467e85">sl_dataspace_t</a> *out)</td></tr>
<tr class="memdesc:a8b58dd5a03d35010ec7803a72b909b01"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to map out a zero vspace segment. Simply opens an anonymous dataspace and maps it at the right vaddr.  <a href="selfloader_8c.html#a8b58dd5a03d35010ec7803a72b909b01">More...</a><br /></td></tr>
<tr class="separator:a8b58dd5a03d35010ec7803a72b909b01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75d14ad5008032352a7497740f962475"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a75d14ad5008032352a7497740f962475">sl_elf_load_region</a> (struct <a class="el" href="structsl__elf__segment__info.html">sl_elf_segment_info</a> si, <a class="el" href="serv__client__helper_8h.html#ae5a06732da52043c9460215f5d8ecaa8">serv_connection_t</a> *fsSession)</td></tr>
<tr class="memdesc:a75d14ad5008032352a7497740f962475"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load an ELF segment region into current vspace.  <a href="selfloader_8c.html#a75d14ad5008032352a7497740f962475">More...</a><br /></td></tr>
<tr class="separator:a75d14ad5008032352a7497740f962475"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada1b0b658578e28370b88c76fa37d8fb"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#ada1b0b658578e28370b88c76fa37d8fb">sl_elf_load</a> (char *file, <a class="el" href="serv__client__helper_8h.html#ae5a06732da52043c9460215f5d8ecaa8">serv_connection_t</a> *fsSession)</td></tr>
<tr class="memdesc:ada1b0b658578e28370b88c76fa37d8fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load given ELF file into the current vspace.  <a href="selfloader_8c.html#ada1b0b658578e28370b88c76fa37d8fb">More...</a><br /></td></tr>
<tr class="separator:ada1b0b658578e28370b88c76fa37d8fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6397f53239a81a2685b31b5fdd78f2c5"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a6397f53239a81a2685b31b5fdd78f2c5">sl_setup_bootinfo_buffer</a> (void)</td></tr>
<tr class="memdesc:a6397f53239a81a2685b31b5fdd78f2c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load boot &amp; ELF information into static address. Load information about the process and its ELF regions into the pre-allocated static buffer, for the process to read after we jump into it. This done so the process knows where its own ELF segment ends, and where its heap region can start.  <a href="selfloader_8c.html#a6397f53239a81a2685b31b5fdd78f2c5">More...</a><br /></td></tr>
<tr class="separator:a6397f53239a81a2685b31b5fdd78f2c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc6d357bd726623e4db7a11ebc686d4c"><td class="memItemLeft" align="right" valign="top">static uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#abc6d357bd726623e4db7a11ebc686d4c">stack_write</a> (uintptr_t stack_top, void *<a class="el" href="unixunix_8c.html#a69ecf571a24e1f0227e484b18a3ac3e3">buf</a>, size_t n)</td></tr>
<tr class="memdesc:abc6d357bd726623e4db7a11ebc686d4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Push onto the stack.  <a href="selfloader_8c.html#abc6d357bd726623e4db7a11ebc686d4c">More...</a><br /></td></tr>
<tr class="separator:abc6d357bd726623e4db7a11ebc686d4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88e59aec8ee928ac7917c8fc2677150b"><td class="memItemLeft" align="right" valign="top">static uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a88e59aec8ee928ac7917c8fc2677150b">stack_write_constant</a> (uintptr_t stack_top, long value)</td></tr>
<tr class="memdesc:a88e59aec8ee928ac7917c8fc2677150b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Push a constant onto the stack.  <a href="selfloader_8c.html#a88e59aec8ee928ac7917c8fc2677150b">More...</a><br /></td></tr>
<tr class="separator:a88e59aec8ee928ac7917c8fc2677150b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba07000d4460b355686e6aa1ed259b44"><td class="memItemLeft" align="right" valign="top">static uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#aba07000d4460b355686e6aa1ed259b44">stack_copy_args</a> (uintptr_t stack_top, int data_len, char *data[], uintptr_t *dest_data)</td></tr>
<tr class="memdesc:aba07000d4460b355686e6aa1ed259b44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Push arguments onto the stack.  <a href="selfloader_8c.html#aba07000d4460b355686e6aa1ed259b44">More...</a><br /></td></tr>
<tr class="separator:aba07000d4460b355686e6aa1ed259b44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f6133b086cd799be119366bdeefeb56"><td class="memItemLeft" align="right" valign="top">static uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a1f6133b086cd799be119366bdeefeb56">system_v_init</a> (char *elf, uintptr_t stack_top)</td></tr>
<tr class="memdesc:a1f6133b086cd799be119366bdeefeb56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise the stack for how musllibc expects it.  <a href="selfloader_8c.html#a1f6133b086cd799be119366bdeefeb56">More...</a><br /></td></tr>
<tr class="separator:a1f6133b086cd799be119366bdeefeb56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac11e1a515e5887fb69a8274726a4f9fa"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#ac11e1a515e5887fb69a8274726a4f9fa">sl_elf_start</a> (char *file)</td></tr>
<tr class="memdesc:ac11e1a515e5887fb69a8274726a4f9fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Jumps into loaded ELF program in current vspace.  <a href="selfloader_8c.html#ac11e1a515e5887fb69a8274726a4f9fa">More...</a><br /></td></tr>
<tr class="separator:ac11e1a515e5887fb69a8274726a4f9fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82ff8f676bc401776e2954942f01df8d"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a82ff8f676bc401776e2954942f01df8d">faketime</a> ()</td></tr>
<tr class="memdesc:a82ff8f676bc401776e2954942f01df8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fake time generator used by <a class="el" href="macwin_8h.html#a3dd9b2ac1832b3e4c3baadd9cb8d5018">dprintf()</a>.  <a href="selfloader_8c.html#a82ff8f676bc401776e2954942f01df8d">More...</a><br /></td></tr>
<tr class="separator:a82ff8f676bc401776e2954942f01df8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a840291bc02cba5474a4cb46a9b9566fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr class="memdesc:a840291bc02cba5474a4cb46a9b9566fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Selfloader main function.  <a href="selfloader_8c.html#a840291bc02cba5474a4cb46a9b9566fe">More...</a><br /></td></tr>
<tr class="separator:a840291bc02cba5474a4cb46a9b9566fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a19d481148afadb2ddf14cc4b09d5cd0a"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structsl__state.html">sl_state</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a19d481148afadb2ddf14cc4b09d5cd0a">selfloaderState</a></td></tr>
<tr class="separator:a19d481148afadb2ddf14cc4b09d5cd0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa28e5f0fc8bfb74718e0a43452728ecd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="tradstdc_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#aa28e5f0fc8bfb74718e0a43452728ecd">dprintfServerName</a> = &quot;SELFLOADER&quot;</td></tr>
<tr class="separator:aa28e5f0fc8bfb74718e0a43452728ecd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56b613d1862918d9ca334c86af989765"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a56b613d1862918d9ca334c86af989765">dprintfServerColour</a> = 36</td></tr>
<tr class="separator:a56b613d1862918d9ca334c86af989765"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac50be546ac1ce6d73bf330bc059c670a"><td class="memItemLeft" align="right" valign="top">static char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#ac50be546ac1ce6d73bf330bc059c670a">slMiniMorecoreRegion</a> [<a class="el" href="selfloader_8h.html#a16b39cd2f4ea490a90a3df102cb06536">SELFLOADER_MINI_MORECORE_REGION_SIZE</a>]</td></tr>
<tr class="separator:ac50be546ac1ce6d73bf330bc059c670a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7c327fb5ef6fe1b6c31e9beb8d2a7bc"><td class="memItemLeft" align="right" valign="top">uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#af7c327fb5ef6fe1b6c31e9beb8d2a7bc">__vsyscall_ptr</a></td></tr>
<tr class="memdesc:af7c327fb5ef6fe1b6c31e9beb8d2a7bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Selfloader's system call table.  <a href="selfloader_8c.html#af7c327fb5ef6fe1b6c31e9beb8d2a7bc">More...</a><br /></td></tr>
<tr class="separator:af7c327fb5ef6fe1b6c31e9beb8d2a7bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63b4b61dafe3c92a92bceff10be88ec6"><td class="memItemLeft" align="right" valign="top">long(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="selfloader_8c.html#a63b4b61dafe3c92a92bceff10be88ec6">syscall_table</a> [])(va_list)</td></tr>
<tr class="memdesc:a63b4b61dafe3c92a92bceff10be88ec6"><td class="mdescLeft">&#160;</td><td class="mdescRight">The spawned process uses this system call table.  <a href="selfloader_8c.html#a63b4b61dafe3c92a92bceff10be88ec6">More...</a><br /></td></tr>
<tr class="separator:a63b4b61dafe3c92a92bceff10be88ec6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Process selfloader system application for RefOS. </p>
<p>Selfloader is a tiny system application that starts in the same address space as the application being boosted. Selfloader then acts on behalf of the starting process, setting up its vspace and loading the ELF segments before jumping into the entry point of the process. In order to avoid vspace address conflicts with the booting process, the Sselfloader process linker script compiles it into a very high RefOS reserved region, away from the vspace of the booting process.</p>
<p>See <a class="el" href="design.html#Startup">Startup</a> </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a6d4ed7b4ceed7d4aef1a7763861716a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d4ed7b4ceed7d4aef1a7763861716a7">&#9670;&nbsp;</a></span>SELFLOADER_ELF_HEADER_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SELFLOADER_ELF_HEADER_SIZE&#160;&#160;&#160;<a class="el" href="refos_8h.html#a0928ee9c4bf6581eab888ff5514a8af2">REFOS_PAGE_SIZE</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The maximum length of the ELF header we support. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a82ff8f676bc401776e2954942f01df8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82ff8f676bc401776e2954942f01df8d">&#9670;&nbsp;</a></span>faketime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t faketime </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fake time generator used by <a class="el" href="macwin_8h.html#a3dd9b2ac1832b3e4c3baadd9cb8d5018">dprintf()</a>. </p>
<p>Fake time, useful for debugging. </p>

</div>
</div>
<a id="a840291bc02cba5474a4cb46a9b9566fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a840291bc02cba5474a4cb46a9b9566fe">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Selfloader main function. </p>

</div>
</div>
<a id="a8b58dd5a03d35010ec7803a72b909b01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b58dd5a03d35010ec7803a72b909b01">&#9670;&nbsp;</a></span>sl_create_zero_segment()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int sl_create_zero_segment </td>
          <td>(</td>
          <td class="paramtype">seL4_Word&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">seL4_Word&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">seL4_Word&#160;</td>
          <td class="paramname"><em>windowSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="init_8h.html#a323f16cf7302a986370bfe46c8467e85">sl_dataspace_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Helper function to map out a zero vspace segment. Simply opens an anonymous dataspace and maps it at the right vaddr. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">start</td><td>The start / base of the zero segment region window. </td></tr>
    <tr><td class="paramname">size</td><td>The size of the zero segment dataspace. </td></tr>
    <tr><td class="paramname">windowSize</td><td>The size of zero segment region window. Could be slightly different to the dataspace region, due to page alignment. </td></tr>
    <tr><td class="paramname">out[out]</td><td>Optional output struct to store windows &amp; dataspace capabilities. If this is set to NULL, the created window and dataspace caps are simply used then discarded. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESUCCESS on success, refos_err_t otherwise. </dd></dl>

</div>
</div>
<a id="ada1b0b658578e28370b88c76fa37d8fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada1b0b658578e28370b88c76fa37d8fb">&#9670;&nbsp;</a></span>sl_elf_load()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int sl_elf_load </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="serv__client__helper_8h.html#ae5a06732da52043c9460215f5d8ecaa8">serv_connection_t</a> *&#160;</td>
          <td class="paramname"><em>fsSession</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Load given ELF file into the current vspace. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>Pointer to mapped ELF header contents. </td></tr>
    <tr><td class="paramname">fsSession</td><td>The dataserver session containing the ELF tile. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESUCCESS on success, refos_err_t otherwise. </dd></dl>

</div>
</div>
<a id="a75d14ad5008032352a7497740f962475"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75d14ad5008032352a7497740f962475">&#9670;&nbsp;</a></span>sl_elf_load_region()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int sl_elf_load_region </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsl__elf__segment__info.html">sl_elf_segment_info</a>&#160;</td>
          <td class="paramname"><em>si</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="serv__client__helper_8h.html#ae5a06732da52043c9460215f5d8ecaa8">serv_connection_t</a> *&#160;</td>
          <td class="paramname"><em>fsSession</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Load an ELF segment region into current vspace. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">si</td><td>The ELF segment infor structure, read from the ELF header. </td></tr>
    <tr><td class="paramname">fsSession</td><td>The dataserver session containing ELF file contents. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESUCCESS on success, refos_err_t otherwise. </dd></dl>

</div>
</div>
<a id="ac11e1a515e5887fb69a8274726a4f9fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac11e1a515e5887fb69a8274726a4f9fa">&#9670;&nbsp;</a></span>sl_elf_start()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void sl_elf_start </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Jumps into loaded ELF program in current vspace. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>The mapped ELF header containing entry point to jump into. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a66848c03663c2ae3342291b7d019fe38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66848c03663c2ae3342291b7d019fe38">&#9670;&nbsp;</a></span>sl_roundup_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int sl_roundup_page </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Helper function to round up to the next page boundary. </p>

</div>
</div>
<a id="a6397f53239a81a2685b31b5fdd78f2c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6397f53239a81a2685b31b5fdd78f2c5">&#9670;&nbsp;</a></span>sl_setup_bootinfo_buffer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void sl_setup_bootinfo_buffer </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Load boot &amp; ELF information into static address. Load information about the process and its ELF regions into the pre-allocated static buffer, for the process to read after we jump into it. This done so the process knows where its own ELF segment ends, and where its heap region can start. </p>

</div>
</div>
<a id="a91b4013891731e48dbbaa9eefa85e681"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91b4013891731e48dbbaa9eefa85e681">&#9670;&nbsp;</a></span>sl_setup_elf_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int sl_setup_elf_header </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="serv__client__helper_8h.html#ae5a06732da52043c9460215f5d8ecaa8">serv_connection_t</a> *&#160;</td>
          <td class="paramname"><em>fsSession</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Open the ELF header dataspace, and map it so we can read it. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fsSession</td><td>Resolved mount point and session of ELF header dataspace. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESUCCESS on success, refos_err_t otherwise. </dd></dl>

</div>
</div>
<a id="aba07000d4460b355686e6aa1ed259b44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba07000d4460b355686e6aa1ed259b44">&#9670;&nbsp;</a></span>stack_copy_args()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uintptr_t stack_copy_args </td>
          <td>(</td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>stack_top</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>data_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t *&#160;</td>
          <td class="paramname"><em>dest_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Push arguments onto the stack. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">stack_top</td><td>The current top of the stack. </td></tr>
    <tr><td class="paramname">data_len</td><td>The number of arguments to push to the stack. </td></tr>
    <tr><td class="paramname">dest_data</td><td>Pointer to the arguments to be pushed to the stack. </td></tr>
    <tr><td class="paramname">dest_data</td><td>When the function returns contains each of the arguments to be pushed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The new top of the stack. </dd></dl>

</div>
</div>
<a id="abc6d357bd726623e4db7a11ebc686d4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc6d357bd726623e4db7a11ebc686d4c">&#9670;&nbsp;</a></span>stack_write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uintptr_t stack_write </td>
          <td>(</td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>stack_top</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Push onto the stack. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">stack_top</td><td>The current top of the stack. </td></tr>
    <tr><td class="paramname">buf</td><td>The buffer to be pushed onto the stack. </td></tr>
    <tr><td class="paramname">n</td><td>The size of the buffer to be pushed onto the stack. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The new top of the stack. </dd></dl>

</div>
</div>
<a id="a88e59aec8ee928ac7917c8fc2677150b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88e59aec8ee928ac7917c8fc2677150b">&#9670;&nbsp;</a></span>stack_write_constant()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uintptr_t stack_write_constant </td>
          <td>(</td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>stack_top</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Push a constant onto the stack. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">stack_top</td><td>The current top of the stack. </td></tr>
    <tr><td class="paramname">value</td><td>The value to be pushed onto the stack. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The new top of the stack. </dd></dl>

</div>
</div>
<a id="a1f6133b086cd799be119366bdeefeb56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f6133b086cd799be119366bdeefeb56">&#9670;&nbsp;</a></span>system_v_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uintptr_t system_v_init </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>elf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>stack_top</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialise the stack for how musllibc expects it. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">elf</td><td>The mapped ELF header containing entry point to jump into. </td></tr>
    <tr><td class="paramname">stack_top</td><td>The current top of the stack. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The new top of the stack. </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="af7c327fb5ef6fe1b6c31e9beb8d2a7bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7c327fb5ef6fe1b6c31e9beb8d2a7bc">&#9670;&nbsp;</a></span>__vsyscall_ptr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uintptr_t __vsyscall_ptr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Selfloader's system call table. </p>

</div>
</div>
<a id="a56b613d1862918d9ca334c86af989765"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56b613d1862918d9ca334c86af989765">&#9670;&nbsp;</a></span>dprintfServerColour</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dprintfServerColour = 36</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa28e5f0fc8bfb74718e0a43452728ecd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa28e5f0fc8bfb74718e0a43452728ecd">&#9670;&nbsp;</a></span>dprintfServerName</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="tradstdc_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> char* dprintfServerName = &quot;SELFLOADER&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a19d481148afadb2ddf14cc4b09d5cd0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19d481148afadb2ddf14cc4b09d5cd0a">&#9670;&nbsp;</a></span>selfloaderState</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsl__state.html">sl_state</a> selfloaderState</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Global self-loader state. </p>

</div>
</div>
<a id="ac50be546ac1ce6d73bf330bc059c670a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac50be546ac1ce6d73bf330bc059c670a">&#9670;&nbsp;</a></span>slMiniMorecoreRegion</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char slMiniMorecoreRegion[<a class="el" href="selfloader_8h.html#a16b39cd2f4ea490a90a3df102cb06536">SELFLOADER_MINI_MORECORE_REGION_SIZE</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>A little mini morecore region for the selfloader, since the libraries selfloader use would like to have malloc() available. </p>

</div>
</div>
<a id="a63b4b61dafe3c92a92bceff10be88ec6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63b4b61dafe3c92a92bceff10be88ec6">&#9670;&nbsp;</a></span>syscall_table</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">long(* syscall_table[])(va_list) </td>
          <td>(</td>
          <td class="paramtype">va_list&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The spawned process uses this system call table. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_9654b8d08f4bba4e84b362c5fd320bee.html">apps</a></li><li class="navelem"><a class="el" href="dir_97a8af02729015cd81823a7e845b3d01.html">selfloader</a></li><li class="navelem"><a class="el" href="dir_e5f169887496c8648fe7a010e844a71c.html">src</a></li><li class="navelem"><a class="el" href="selfloader_8c.html">selfloader.c</a></li>
    <li class="footer">Generated on Sat Jun 10 2023 10:14:24 for RefOS by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
