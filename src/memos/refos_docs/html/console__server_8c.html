<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RefOS: apps/console_server/src/console_server.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RefOS
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">Multi-server operating system on seL4</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('console__server_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">console_server.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Console Server main source file.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="stdio_8h_source.html">stdio.h</a>&gt;</code><br />
<code>#include &lt;assert.h&gt;</code><br />
<code>#include &lt;<a class="el" href="refos_8h_source.html">refos/refos.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="init_8h_source.html">refos-util/init.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="morecore_8h_source.html">refos-io/morecore.h</a>&gt;</code><br />
<code>#include &quot;<a class="el" href="console__server_2src_2state_8h_source.html">state.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="console__server_2src_2dispatchers_2dspace_2dspace_8h_source.html">dispatchers/dspace/dspace.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="stdio__dspace_8h_source.html">dispatchers/dspace/stdio_dspace.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="console__server_2src_2dispatchers_2serv__dispatch_8h_source.html">dispatchers/serv_dispatch.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="console__server_2src_2dispatchers_2client__watch_8h_source.html">dispatchers/client_watch.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ada1cb79cd9ef5d01e77e8cef6a12876c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="console__server_8c.html#ada1cb79cd9ef5d01e77e8cef6a12876c">console_server_handle_message</a> (struct <a class="el" href="structconserv__state.html">conserv_state</a> *s, <a class="el" href="serv__common_8h.html#a31b2623867d2146df7bc0377664561e9">srv_msg_t</a> *msg)</td></tr>
<tr class="memdesc:ada1cb79cd9ef5d01e77e8cef6a12876c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle messages recieved by the Console server.  <a href="console__server_8c.html#ada1cb79cd9ef5d01e77e8cef6a12876c">More...</a><br /></td></tr>
<tr class="separator:ada1cb79cd9ef5d01e77e8cef6a12876c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e3842a22e7b6bfe3bd3f943b70c6cdf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="console__server_8c.html#a5e3842a22e7b6bfe3bd3f943b70c6cdf">console_server_mainloop</a> (void)</td></tr>
<tr class="memdesc:a5e3842a22e7b6bfe3bd3f943b70c6cdf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main console server message loop. Simply loops through recieving and dispatching messages repeatedly.  <a href="console__server_8c.html#a5e3842a22e7b6bfe3bd3f943b70c6cdf">More...</a><br /></td></tr>
<tr class="separator:a5e3842a22e7b6bfe3bd3f943b70c6cdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82ff8f676bc401776e2954942f01df8d"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="console__server_8c.html#a82ff8f676bc401776e2954942f01df8d">faketime</a> ()</td></tr>
<tr class="memdesc:a82ff8f676bc401776e2954942f01df8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fake time, useful for debugging.  <a href="console__server_8c.html#a82ff8f676bc401776e2954942f01df8d">More...</a><br /></td></tr>
<tr class="separator:a82ff8f676bc401776e2954942f01df8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a840291bc02cba5474a4cb46a9b9566fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="console__server_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr class="memdesc:a840291bc02cba5474a4cb46a9b9566fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main Console server entry point.  <a href="console__server_8c.html#a840291bc02cba5474a4cb46a9b9566fe">More...</a><br /></td></tr>
<tr class="separator:a840291bc02cba5474a4cb46a9b9566fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ade011eb59956694748935def8385572c"><td class="memItemLeft" align="right" valign="top">static char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="console__server_8c.html#ade011eb59956694748935def8385572c">conServMMapRegion</a> [<a class="el" href="console__server_2src_2state_8h.html#a3e8960c6e4c56e4ff06442de2e8da1e7">CONSERV_MMAP_REGION_SIZE</a>]</td></tr>
<tr class="memdesc:ade011eb59956694748935def8385572c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Console server's static morecore region.  <a href="console__server_8c.html#ade011eb59956694748935def8385572c">More...</a><br /></td></tr>
<tr class="separator:ade011eb59956694748935def8385572c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7c327fb5ef6fe1b6c31e9beb8d2a7bc"><td class="memItemLeft" align="right" valign="top">uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="console__server_8c.html#af7c327fb5ef6fe1b6c31e9beb8d2a7bc">__vsyscall_ptr</a></td></tr>
<tr class="memdesc:af7c327fb5ef6fe1b6c31e9beb8d2a7bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Console server's system call table.  <a href="console__server_8c.html#af7c327fb5ef6fe1b6c31e9beb8d2a7bc">More...</a><br /></td></tr>
<tr class="separator:af7c327fb5ef6fe1b6c31e9beb8d2a7bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Console Server main source file. </p>
<p>The RefOS Console server acts as a simple device driver server for basic system console input / output functionality (eg. serial I/O for seeing things on the screen, EGA console output). It is booted as a special system app in order for the system to to gain output functionality as early as possible in the booting process. The only way to get output functionality before the console server is up is to enable debug kernel mode and use seL4_DebugPutChar().</p>
<div class="image">
<img src="conserv.png" alt=""/>
</div>
<p>The Console server: </p><ul>
<li>
Does NOT support providing pager service to clients. </li>
<li>
Does NOT support providing content-initialisation for another dataserver. </li>
<li>
Does NOT supports parameter buffers using an external dataspace (i.e. a dataspace provided by another dataserver). </li>
<li>
Does NOT support parameter buffers using an internal dataspace (i.e. a dataspace provided the fileserver itself). </li>
<li>
Does NOT support having its dataspace content-initalised by an external dataspace. </li>
<li>
Ignores nBytes parameter in <a class="el" href="wceconf_8h.html#a06cb3578c7c2e0259fdb09e63f992af3">open()</a> method (device IO doesn't have a file size). </li>
</ul>
<p>The Console server provides the dataspaces: <code>/dev_console/serial</code> and <code>/dev/_console/screen</code>. </p><ul>
<li>
Writing to <code>/dev_console/serial</code> results in outputting to serial device. </li>
<li>
Reading from <code>/dev_console/serial</code> results in reading from serial device. </li>
<li>
Writing to <code>/dev_console/screen</code> results in outputting to EGA screen buffer. </li>
<li>
Reading from <code>/dev_console/screen</code> is unsupported. </li>
</ul>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ada1cb79cd9ef5d01e77e8cef6a12876c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada1cb79cd9ef5d01e77e8cef6a12876c">&#9670;&nbsp;</a></span>console_server_handle_message()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int console_server_handle_message </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structconserv__state.html">conserv_state</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="serv__common_8h.html#a31b2623867d2146df7bc0377664561e9">srv_msg_t</a> *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handle messages recieved by the Console server. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>The global Console server state. (No ownership transfer) </td></tr>
    <tr><td class="paramname">msg</td><td>The recieved message. (No ownership transfer) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>DISPATCH_SUCCESS if message dispatched, DISPATCH_ERROR if unknown message. </dd></dl>

</div>
</div>
<a id="a5e3842a22e7b6bfe3bd3f943b70c6cdf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e3842a22e7b6bfe3bd3f943b70c6cdf">&#9670;&nbsp;</a></span>console_server_mainloop()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void console_server_mainloop </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Main console server message loop. Simply loops through recieving and dispatching messages repeatedly. </p>

</div>
</div>
<a id="a82ff8f676bc401776e2954942f01df8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82ff8f676bc401776e2954942f01df8d">&#9670;&nbsp;</a></span>faketime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t faketime </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fake time, useful for debugging. </p>

</div>
</div>
<a id="a840291bc02cba5474a4cb46a9b9566fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a840291bc02cba5474a4cb46a9b9566fe">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main Console server entry point. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="af7c327fb5ef6fe1b6c31e9beb8d2a7bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7c327fb5ef6fe1b6c31e9beb8d2a7bc">&#9670;&nbsp;</a></span>__vsyscall_ptr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uintptr_t __vsyscall_ptr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Console server's system call table. </p>

</div>
</div>
<a id="ade011eb59956694748935def8385572c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade011eb59956694748935def8385572c">&#9670;&nbsp;</a></span>conServMMapRegion</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char conServMMapRegion[<a class="el" href="console__server_2src_2state_8h.html#a3e8960c6e4c56e4ff06442de2e8da1e7">CONSERV_MMAP_REGION_SIZE</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Console server's static morecore region. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_9654b8d08f4bba4e84b362c5fd320bee.html">apps</a></li><li class="navelem"><a class="el" href="dir_52ca6691134020d7990716e855f9e6e4.html">console_server</a></li><li class="navelem"><a class="el" href="dir_9fc4745385e894d605070f1ace990cff.html">src</a></li><li class="navelem"><a class="el" href="console__server_8c.html">console_server.c</a></li>
    <li class="footer">Generated on Sat Jun 10 2023 10:14:23 for RefOS by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
