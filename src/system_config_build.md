# システムの構成とビルド

seL4とその関連プロジェクトはそのビルドシステムの実装に[CMake](https://cmake.org/)
ファミリーのツールを使用しています。seL4のビルドシステムとは以下を管理する
CMakeスクリプトのコレクションのことです。

- システム構成: プラットフォームフラグやアプリケーション設定などの構成
  オプション
- 依存関係の構造: ビルド順序の依存関係を追跡します
- ビルド: ハードウェアにデプロイするバイナリ成果物を生成します

以下のドキュメントでは以下を行うためのseL4ビルドシステムの使用方法について
説明します。

- システム構成とビルドの実行
- ビルドシステムのプロジェクトへの組み込み
- カーネルのスタンドアローン構成とビルド

## CMakeの基本

CMakeの完全なガイドについては[広範なドキュメント](https://cmake.org/cmake/help/latest/)を
読むことができますが、ここではツリー外ビルドを含むCMakeの特定のワークフローを
仮定します。

CMakeはそれ自体はビルドツールではなく、ビルドジェネレータです。つまり、CMakeは
通常はMakefileやNinjaスクリプトなどのビルドスクリプトを生成し、GNU Makeや
Ninjaなどのツールを使って実際のビルドを実行することになります。

### 前提条件

以下を前提としています。

- 適切なバージョンのCMakeがインストールされている
- Ninja CMakeジェネレータを使用している
- [Getting started](https://docs.sel4.systems/GettingStarted)のページで
  説明されているようにRepoツールを使ってプロジェクトをチェックアウトする
  方法を理解している。
- プロジェクトをビルドするために必要な[依存関係](https://docs.sel4.systems/HostDependencies)がインストールされている。

## [seL4プロジェクトの構成とビルド](config_build_sel4_project.md)

> このページではこのビルドシステムを使用しているプロジェクトと対話し、
> ビルドする方法について説明します。新しいプロジェクトの開発については
> [ビルドシステムを組み込む](incorporating_into_project.md)を参照してください。

## [ビルドシステムをプロジェクトに組み込む](incorporating_into_project.md)

> このページではCMakeベースのビルドシステムについて詳しく説明し、
> 新しいプロジェクトにビルドシステムを組み込むために必要な情報を提供します。
> プロジェクトのニーズや希望するカスタマイズに応じて、さまざまな方法で
> 組み合わせることができる種々のピースが存在します。これは複数のリポジトリに
> 分散しているCMakeファイルの分割に反映されています。

## [カーネルのスタンドアローンビルド](https://docs.sel4.systems/Developing/Building/seL4Standalone)

> このページにはユーザレベルやカーネル以前に実行されるローダを持たない
> seL4カーネルをスタンドアロンでビルドするためのドキュメントがあります。
> これは通常、検証目的やロジェクトがユーザレベルやカーネル以前の初期化を
> 完全に制御したい場合に使用されます。カーネルだけをビルドするための検証用
> コンフィギュレーションだけを維持管理しています。このページはseL4
> プロジェクトのビルドシステムの使用に慣れていることを前提としており、
> 上の2つのドキュメントをベースにしています。

## Gotchas

cmakeを使用する際に陥りがちなgotachaと簡単なミスのリストです。

- cmakeに`-C`オプションで渡す設定ファイルは`.cmake`で終わる必要があります。
  そうしないとCMakeはあなたのファイルを黙って捨ててしまいます。

## 古いビルドシステム

以前はKbuildベースのビルドシステムを使用していました。このシステムに関する
古いドキュメントは[ここ](https://docs.sel4.systems/Developing/Building/OldBuildSystem/)にあります。
